<!DOCTYPE html>
<html lang="zh-en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.4.12/dist/antd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.4.12/dist/antd-with-locales.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/ant-design-vue@1.4.12/dist/antd.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.7.0/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="/static/style.css" type="text/css" />
    <title>疫情数据</title>
  </head>

  <style>
    .ant-tabs-top-bar {
      height: 50px !important;
    }
    .yellow {
      background-color: yellow;
    }
  </style>

  <body style="text-align: center; margin: 0 auto;">
    <div id="app">
      <h1>
        {{area}}<span v-text="title"></span>
        <br />
        【{{date}}】
      </h1>

      <a-card>
        <a-tabs defaultactivekey="1">
          <a-tab-pane key="1" tab="国内疫情">
            <div id="trendChart" :style="{width:'100%', height:'500px'}"></div>

            <a-table
              id="area"
              :columns="columns"
              :data-source="provlist"
              :row-key="record => record.area"
              :pagination="false"
              @expand="expand"
              :row-class-name="rowClassName"
            >
              <a-table
                slot="expandedRowRender"
                :columns="innerColumns"
                :data-source="citylist"
                :row-key="innerRecord=>innerRecord.city"
                :pagination="false"
                :show-header="false"
                :style="{backgroundColor: this.yellow}"
                :row-class-name="rowClassName"
              >
                <template
                  slot="innertitle"
                  slot-scope="text, innerRecord, index"
                >
                  <a href="#">
                    <span v-text="text"></span>
                  </a>
                  <a-button type="primary" @click="handEdit(innerRecord)"
                    >编辑</a-button
                  >
                </template>
              </a-table>
            </a-table>
          </a-tab-pane>
          <a-tab-pane key="2" tab="国外疫情">国外疫情</a-tab-pane>
          <a-tab-pane key="3" tab="实时播报">实时播报</a-tab-pane>
          <a-tab-pane key="4" tab="全民热搜">全民热搜</a-tab-pane>
          <a-tab-pane key="4" tab="迁徙地图">迁徙地图</a-tab-pane>
        </a-tabs>
      </a-card>
    </div>

    <script>
      const columns = [
        {
          title: "疫情地区",
          dataIndex: "area",
          width: "200px",
        },
        {
          title: "新增",
          dataIndex: "confirmedRelative",
          width: "200px",
          sorter: (a, b) => a.confirmedRelative - b.confirmedRelative,
        },
        {
          title: "现有",
          dataIndex: "curConfirm",
          width: "200px",
          sorter: (a, b) => a.curConfirm - b.curConfirm,
        },
        {
          title: "累计",
          dataIndex: "confirmed",
          width: "200px",
          sorter: (a, b) => a.confirmed - b.confirmed,
        },
        {
          title: "治愈",
          dataIndex: "crued",
          width: "200px",
          sorter: (a, b) => a.crued - b.crued,
        },
        {
          title: "死亡",
          dataIndex: "died",
          width: "200px",
          sorter: (a, b) => a.died - b.died,
        },
      ];

      const innerColumns = [
        {
          title: "疫情地区",
          dataIndex: "city",
          width: "200px",
          scopedSlots: { customRender: " innertitle " },
        },
        {
          title: "新增",
          dataIndex: "confirmedRelative",
          width: "200px",
          sorter: (a, b) => a.confirmedRelative - b.confirmedRelative,
        },
        {
          title: "现有",
          dataIndex: "curConfirm",
          width: "200px",
          sorter: (a, b) => a.curConfirm - b.curConfirm,
        },
        {
          title: "累计",
          dataIndex: "confirmed",
          width: "200px",
          sorter: (a, b) => a.confirmed - b.confirmed,
        },
        {
          title: "治愈",
          dataIndex: "crued",
          width: "200px",
          sorter: (a, b) => a.crued - b.crued,
        },
        {
          title: "死亡",
          dataIndex: "died",
          width: "200px",
          sorter: (a, b) => a.died - b.died,
          columnRule: this.yellow,
        },
      ];

      var app = new Vue({
        el: "#app",
        data() {
          return {
            title: "",
            url: "/getRTBaiduData",
            provlist: [],
            columns,
            innerColumns,
            citylist: [],
            expandRowkeys: [],
            rowStyle: "rowStyle",
            yellow: "white",
            box: [],
          };
        },
        methods: {
          rowClassName(row) {
            if (row.died >= 50) {
              return "yellow";
            } else {
              return "";
            }
          },
          getRTDataByGet: function () {
            let _this = this;
            axios
              .get(_this.url)
              .then(function (response) {
                let data = response.data;
                _this.title = data.page.title;
                _this.provlist = data.component[0].caseList;

                let trendChart = echarts.init(
                  document.getElementById("trendChart")
                );
                console.log(trendChart);
                trendChart.setOption({
                  title: {
                    text: "全国 疫情数据 趋势",
                  },
                  tooltip: {
                    trigger: "axis",
                  },
                  legend: {
                    data: [
                      "确诊",
                      "疑似",
                      "治愈",
                      "死亡",
                      "新增确诊",
                      "新增疑似",
                    ],
                  },
                  grid: {
                    left: "3%",
                    right: "4%",
                    bottom: "3%",
                    containLabel: true,
                  },
                  toolbox: {
                    feature: {
                      saveAsImage: {},
                    },
                  },
                  xAxis: {
                    type: "category",
                    boundaryGap: false,
                    data: data.component[0].trend.undataDate,
                  },
                  yAxis: {
                    type: "value",
                  },
                  series: [
                    {
                      name: "确诊",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[0].data,
                    },
                    {
                      name: "疑似",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[1].data,
                    },
                    {
                      name: "治愈",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[2].data,
                    },
                    {
                      name: "死亡",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[3].data,
                    },
                    {
                      name: "新增确诊",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[4].data,
                    },
                    {
                      name: "新增疑似",
                      type: "line",
                      stack: "总量",
                      data: data.component[0].trend.list[5].data,
                    },
                  ],
                });
              })
              .catch(function (error) {
                console.log(error);
              });
          },

          expand(expanded, record) {
            this.expandRowkeys = [];

            if (expanded) {
              this.expandRowkeys = [record.area];
              this.citylist = record.subList;
              // console.log(this.citylist);
              var n = 0;
              for (let i = 0; i < this.citylist.length; i++) {
                var element = this.citylist[i];
                var con = this.box;
                if (element.died > 50) {
                  //   console.log(i);
                  // console.log(element.city + "-死亡人数：" + element.died);
                  con.push("\n" + element.city + "-死亡人数：" + element.died);
                  n++;
                  console.log(con);
                  // this.yellow = "yellow";
                } else {
                  // this.yellow = "white";
                }
                // console.log(element);
              }

              if ((con.length = n)) {
                alert(
                  "WARNING❗❗❗" +
                    "\n" +
                    "以下城市死亡人数超过50，请谨慎前往！" +
                    con
                );
              } else {
                // alert("该省份无死亡人数超过50的城市！")
              }
            }
          },
          handEdit(r) {
            console.log(r);
          },
        },
        mounted() {
          this.getRTDataByGet();
        },
      });
    </script>
  </body>
</html>
